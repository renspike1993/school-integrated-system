<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Upload & Count Pages</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @media print {
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen p-4 sm:p-10">

    <div class="w-full max-w-2xl mx-auto bg-white shadow p-4 sm:p-6 rounded">
        <h1 class="text-lg sm:text-xl font-bold mb-4">Upload PDF / DOCX and Count Pages</h1>

        <!-- Upload Form -->
        <form method="POST" enctype="multipart/form-data" class="mb-6 no-print">
            {% csrf_token %}
            <input type="file" name="file" accept=".pdf,.docx"
                class="border p-2 w-full rounded mb-3 text-sm sm:text-base" required>

            <button class="bg-blue-600 text-white w-full sm:w-auto px-4 py-2 rounded hover:bg-blue-700 text-sm sm:text-base">
                Upload & Count
            </button>
        </form>

        <!-- Upload Result -->
        {% if page_count %}
        <div class="p-4 bg-gray-50 border rounded mb-4 text-sm sm:text-base">
            <p class="font-semibold">
                Page Count:
                <span class="text-blue-600">{{ page_count }}</span>
            </p>

            {% if paper_size %}
            <p class="font-semibold mt-1">
                Paper Size:
                <span class="text-green-600">{{ paper_size }}</span>
            </p>
            {% endif %}

            {% if file_url %}
            <p class="mt-2">
                <a href="{{ file_url }}" target="_blank" class="text-blue-500 underline">
                    View Uploaded File
                </a>
            </p>
            {% endif %}
        </div>
        {% endif %}

        <!-- Uploaded Documents Table -->
        {% if documents %}
        <h2 class="text-base sm:text-lg font-semibold mb-2">Uploaded Documents</h2>

        <!-- Make table scrollable on phones -->
        <div class="overflow-x-auto">
            <table class="min-w-full text-sm">
                <thead class="bg-gray-200 text-xs sm:text-sm">
                    <tr>
                        <th class="p-2">File</th>
                        <th class="p-2">Pages</th>
                        <th class="p-2">Size</th>
                        <th class="p-2">Paper</th>
                        <th class="p-2">Uploaded</th>
                        <th class="p-2">Action</th>
                    </tr>
                </thead>

                <tbody>
                    {% for doc in documents %}
                    <tr class="border-b">
                        <td class="p-2 truncate max-w-[120px] sm:max-w-none">
                            <a href="{{ doc.file.url }}" class="text-blue-600 underline" target="_blank">
                                {{ doc.filename }}
                            </a>
                        </td>

                        <td class="p-2 text-center">{{ doc.page_count }}</td>
                        <td class="p-2 text-center">{{ doc.file_size|filesizeformat }}</td>
                        <td class="p-2 text-center">{{ doc.paper_size }}</td>

                        <td class="p-2 text-center whitespace-nowrap">
                            {{ doc.uploaded_at|date:"Y-m-d H:i" }}
                        </td>

                        <td class="p-2 text-center">
                            <a href="{% url 'print_document' doc.id %}"
                                class="px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs sm:text-sm">
                                Print
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="p-4 text-center text-gray-500">No uploaded files yet.</td>
                    </tr>
                    {% endfor %}
                </tbody>

            </table>
        </div>
        {% endif %}
    </div>

</body>

</html>
