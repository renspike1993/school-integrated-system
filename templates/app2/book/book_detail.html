{% extends "base.html" %} {% block title %}{{ book.title }}{% endblock %} {% block content %} {% load static %}
<div class="max-w-5xl mx-auto mt-8 space-y-6">
	<!-- Header -->
	<div class="flex justify-between items-center">
		<h2 class="text-2xl font-bold text-gray-900">{{ book.title }}</h2>

		<a href="{% url 'book_list' %}" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 text-sm flex items-center gap-1"> <i class="fas fa-arrow-left text-xs"></i> Back to List </a>
	</div>

	<!-- Book Info Card -->
	<!-- Book Info Card -->
	<div class="bg-white rounded-lg shadow flex flex-col sm:flex-row overflow-hidden">
		<!-- Book Cover -->
		<div class="sm:w-1/3 bg-gray-100 flex items-center justify-center p-4">
			{% if book.cover_image %}
			<img src="{{ book.cover_image.url }}" alt="{{ book.title }}" class="w-full max-w-xs max-h-64 object-contain rounded-md shadow-sm" />
			{% else %}
			<img src="{% static 'images/default_cover.png' %}" alt="No Cover" class="w-full max-w-xs max-h-64 object-contain rounded-md shadow-sm" />
			{% endif %}
		</div>

		<!-- Book Information -->
		<div class="flex-1 p-6 grid grid-cols-1 gap-4 text-sm text-gray-700">
			<div><span class="font-medium">Title:</span> {{ book.title }}</div>
			<div><span class="font-medium">Author:</span> {{ book.author }}</div>
			<div><span class="font-medium">ISBN:</span> {{ book.isbn }}</div>
			<div><span class="font-medium">Publisher:</span> {{ book.publisher }}</div>
			<div><span class="font-medium">Year:</span> {{ book.publication_year }}</div>
			{% if book.summary %}
			<div class="col-span-1 sm:col-span-2"><span class="font-medium">Summary:</span> {{ book.summary }}</div>
			{% endif %}
		</div>
	</div>

	<!-- Copies Header + Actions -->
	<div class="flex justify-between items-center">
		<h3 class="text-xl font-semibold text-gray-900">Copies</h3>

		<div class="flex items-center gap-2">
			<a href="{% url 'bookbarcode_create' book.pk %}" class="px-4 py-2 bg-blue-600 text-white rounded-md text-sm flex items-center gap-1 hover:bg-blue-700"> <i class="fas fa-plus text-xs"></i> Add Copy </a>

			<a href="{% url 'book_update' book.pk %}" class="px-4 py-2 bg-yellow-500 text-white rounded-md text-sm flex items-center gap-1 hover:bg-yellow-600"> <i class="fas fa-pen text-xs"></i> Edit </a>

			<a href="{% url 'book_delete' book.pk %}" class="px-4 py-2 bg-red-600 text-white rounded-md text-sm flex items-center gap-1 hover:bg-red-700"> <i class="fas fa-trash text-xs"></i> Delete </a>
		</div>
	</div>

	{% if book.barcodes.all %}
	<!-- Inventory Table -->
	<div class="bg-white rounded-lg shadow overflow-x-auto">
		<table class="w-full text-sm">
			<thead class="bg-gray-50 border-b border-gray-200">
				<tr>
					<th class="px-4 py-2 text-left font-semibold text-gray-600 uppercase">Barcode</th>
					<th class="px-4 py-2 text-left font-semibold text-gray-600 uppercase">Status</th>
					<th class="px-4 py-2 text-left font-semibold text-gray-600 uppercase">Borrower</th>
					<th class="px-4 py-2 text-left font-semibold text-gray-600 uppercase">Borrowed Date</th>
					<th class="px-4 py-2 text-left font-semibold text-gray-600 uppercase">Actions</th>
				</tr>
			</thead>

			<tbody class="divide-y divide-gray-200">
				{% for barcode in book.barcodes.all %} {% with last_borrow=barcode.borrowedbook_set.last %}
				<tr class="hover:bg-gray-50">
					<!-- BARCODE -->
					<td class="px-4 py-2 font-mono text-gray-900">{{ barcode.barcode }}</td>

					<!-- STATUS -->
					<td class="px-4 py-2">
						{% if last_borrow %} {% if last_borrow.status == "borrowed" %}
						<span class="px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full text-xs font-semibold">Borrowed</span>
						{% elif last_borrow.status == "overdue" %}
						<span class="px-2 py-0.5 bg-red-100 text-red-700 rounded-full text-xs font-semibold">Overdue</span>
						{% elif last_borrow.status == "returned" %}
						<span class="px-2 py-0.5 bg-green-100 text-green-700 rounded-full text-xs font-semibold">Returned</span>
						{% endif %} {% else %}
						<span class="px-2 py-0.5 bg-gray-200 text-gray-700 rounded-full text-xs font-semibold">Available</span>
						{% endif %}
					</td>

					<!-- BORROWER -->
					<td class="px-4 py-2 text-gray-700">
						{% if last_borrow and last_borrow.status != "returned" %} {{ last_borrow.borrower.first_name }} {{ last_borrow.borrower.last_name }} {% else %}
						<span class="text-gray-400 text-xs">—</span>
						{% endif %}
					</td>

					<!-- DATE BORROWED -->
					<td class="px-4 py-2 text-gray-700">
						{% if last_borrow and last_borrow.status != "returned" %} {{ last_borrow.date_borrowed|date:"M j, Y" }} {% else %}
						<span class="text-gray-400 text-xs">—</span>
						{% endif %}
					</td>

					<!-- ACTIONS -->
					<td class="px-4 py-2 text-right flex gap-2 justify-end">
						<a href="{% url 'bookbarcode_delete' book.pk barcode.pk %}" class="px-2 py-1 text-red-600 border border-red-400 rounded hover:bg-red-50 text-xs flex items-center gap-1"> <i class="fas fa-trash text-xs"></i> Delete </a>
					</td>
				</tr>
				{% endwith %} {% endfor %}
			</tbody>
		</table>
	</div>

	{% else %}
	<div class="text-center py-12 text-gray-500 space-y-2">
		<i class="fas fa-box text-4xl text-gray-300"></i>
		<p>No copies added yet.</p>
	</div>
	{% endif %}
</div>

{% endblock %}
